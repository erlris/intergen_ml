### 0. Setup ------
rm(list = ls())
options("scipen"=100, "digits"=4)
set.seed(123)
setwd("/Users/jack/git_repos/intergen_ml") # Jack
# Load packages
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(stargazer)
# set default ggplot size
theme_set(theme_gray(base_size = 18))
### 1. Load results ------
res <- as_tibble(readRDS("data/modelresults.rds"))
res.reg <- as_tibble(readRDS("data/regionresults.rds"))
res.reg.scatter <- res.reg %>% mutate(completeness = rsquared_rank/ rsquared_full) %>%
select(region, observations, earn_sd, edu_sd, wealth_sd, earn_edu_cor, earn_wealth_cor,
rsquared_rank, rsquared_full, completeness)
### 4.1 Rank-rank R2 and complete R2 ------
plotdata <- res.reg.scatter %>%
ggplot(aes(x = rsquared_rank, y = rsquared_full, size = observations)) +
geom_point() + xlab("rank-rank R2") +
ylab("Full model R2")
plotdata
ggsave(file = "graphs/regions_R2.pdf",
height = 08, width = 11)
res.reg.scatter %>%
filter(observations > 200) %>%
select(completeness, earn_sd,edu_sd, wealth_sd,
earn_edu_cor, earn_wealth_cor) %>%
rename("Earnings sd" = earn_sd,
"Education sd" = edu_sd,
"Wealth sd" = wealth_sd,
"Earnings and Education corr" = earn_edu_cor,
"Earnings and Wealth corr" = earn_wealth_cor) %>%
gather(key = variable, value = value, - completeness) %>%
ggplot(aes(x = value, y = completeness)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x="Value", y = "Completeness") +
facet_wrap("variable", scales = "free_x")
ggsave(file = "graphs/completeness_dist.pdf",
height = 11, width = 11)
stargazer(res.reg.scatter, summary = F)
?mutate_all
res.reg.table <- round(res.reg.table, digits = 2)
res.reg.table <- res.reg %>% mutate(completeness = rsquared_rank/ rsquared_full) %>%
select(region, observations, earn_sd, edu_sd, wealth_sd, earn_edu_cor, earn_wealth_cor,
rsquared_rank, rsquared_full, completeness)
res.reg.table <- round(res.reg.table, digits = 2)
?transmute
?transmute_all
res.reg.table <- res.reg.table %>% transmute_all(funs(round = round(., digits = 2))
)
res.reg.table <- res.reg %>% mutate(completeness = rsquared_rank/ rsquared_full) %>%
select(region, observations, earn_sd, edu_sd, wealth_sd, earn_edu_cor, earn_wealth_cor,
rsquared_rank, rsquared_full, completeness) %>%
mutate(earn_sd = round(earn_sd, digits = 2))
res.reg.table <- res.reg %>% mutate(completeness = rsquared_rank/ rsquared_full) %>%
select(region, observations, earn_sd, edu_sd, wealth_sd, earn_edu_cor, earn_wealth_cor,
rsquared_rank, rsquared_full, completeness) %>%
mutate(earn_sd = round(earn_sd, digits = 2),
edu_sd = round(earn_sd, digits = 2),
wealth_sd = round(earn_sd, digits = 2),
earn_edu_cor = round(earn_sd, digits = 2),
earn_wealth_cor = round(earn_sd, digits = 2),
rsquared_rank = round(earn_sd, digits = 3),
rsquared_full = round(earn_sd, digits = 3),
completeness = round(completeness, digits = 3))
res.reg.table
stargazer(res.reg.table, summary = F)
res.reg.scatter %>%
filter(observations > 200) %>%
select(completeness, earn_sd,edu_sd, wealth_sd,
earn_edu_cor, earn_wealth_cor) %>%
rename("Earnings sd" = earn_sd,
"Education sd" = edu_sd,
"Wealth sd" = wealth_sd,
"Earnings and Education corr" = earn_edu_cor,
"Earnings and Wealth corr" = earn_wealth_cor) %>%
gather(key = variable, value = value, - completeness) %>%
ggplot(aes(x = value, y = completeness)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x="Value", y = "Completeness") +
facet_wrap("variable", scales = "free_x")
ggsave(file = "graphs/completeness_dist.pdf",
height = 11, width = 11)
res.reg.scatter %>%
filter(observations > 200) %>%
select(completeness, earn_sd,edu_sd, wealth_sd,
earn_edu_cor, earn_wealth_cor) %>%
rename("Earnings sd" = earn_sd,
"Education sd" = edu_sd,
"Wealth sd" = wealth_sd,
"Earnings and Education corr" = earn_edu_cor,
"Earnings and Wealth corr" = earn_wealth_cor) %>%
gather(key = variable, value = value, - completeness) %>%
ggplot(aes(x = value, y = completeness)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x="Value", y = "Completeness") +
facet_wrap("variable", scales = "free_x")
ggsave(file = "graphs/completeness_dist.pdf",
height = 09, width = 11)
stargazer(res.reg.table, summary = F)
plotdata <- res.reg.scatter %>%
ggplot(aes(x = rsquared_rank, y = rsquared_full, size = observations)) +
geom_point() + xlab("rank-rank R2") +
ylab("Full model R2")
plotdata
ggsave(file = "graphs/regions_R2.pdf",
height = 08, width = 11)
?stargazer
stargazer(res.reg.table, summary = F, column.sep.width = "2pt")
